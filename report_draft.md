# 基于降维与分类的网络入侵检测系统研究

## 摘要

本研究针对网络入侵检测场景中的高维流量特征问题，提出了降维与分类相结合的检测方法。研究基于 CSE-CIC-IDS2018 数据集，选取 30 个核心流量统计特征，系统对比了 PCA、LDA 与 t-SNE 三种降维方法在不同维度设置下的信息保留与类间分离能力，并结合 SVM、随机森林与逻辑回归三类分类器构建了 15 组"降维×分类"组合进行评测。实验结果表明，[待填充]。研究还针对高发攻击类型进行了单独评估，并从误报率与漏报率的角度讨论了模型在实际部署中的安全性与可用性。

**关键词**：入侵检测；降维；分类；机器学习；网络安全

---

## 1 设计背景与要求

### 1.1 研究背景

随着网络攻击手段的日益复杂化与多样化，传统基于规则的入侵检测系统（Intrusion Detection System, IDS）逐渐暴露出检测范围有限、误报率高、难以适应新型威胁等问题。基于机器学习的入侵检测方法通过从历史流量数据中学习攻击模式，能够在一定程度上提升检测准确率并增强对未知攻击的泛化能力。然而，网络流量特征通常具有高维性，直接在原始特征空间中训练模型不仅增加计算复杂度与存储开销，还可能因维度灾难导致模型过拟合与泛化性能下降。因此，如何在保持检测准确性的前提下降低特征维度、优化检测效率，成为当前入侵检测研究的关键问题之一。

降维技术通过将高维特征映射至低维子空间，在压缩数据规模的同时保留关键信息，为后续分类任务提供更紧凑的输入表示。主成分分析（PCA）通过最大化方差方向构造正交基，实现无监督线性降维；线性判别分析（LDA）引入类别标签信息，寻求最大化类间可分性的投影方向；t-分布随机邻域嵌入（t-SNE）则侧重于保持高维数据的局部邻域结构，在可视化与聚类分析中表现优异。这三类方法在理论假设、计算复杂度与适用场景上存在显著差异，对其在入侵检测任务中的性能进行系统对比具有重要的学术与实践价值。

分类器的选择同样影响检测效果。支持向量机（SVM）通过核映射与最大间隔策略在小样本与非线性问题上具有良好泛化能力；随机森林作为集成模型能够处理高维数据并提供特征重要性评估；逻辑回归则以简洁的模型结构与可解释性见长，适合作为基线方法。本研究将三类降维方法与三类分类器进行组合评测，旨在从准确率、误报率、漏报率与检测耗时等多维度指标出发，为中小型网络环境下的入侵检测系统设计提供可复用的方法参考与实证依据。

### 1.2 研究目标与要求

本研究的核心目标是构建基于降维与分类的网络入侵检测模型，并通过系统实验评估不同方法组合的性能表现。具体要求如下：

1. **数据集选用与预处理**：采用 CSE-CIC-IDS2018 数据集，该数据集由加拿大通信安全局（CSE）与加拿大网络安全研究所（CIC）联合构建，包含多种攻击类型与正常流量 [1][2]。数据集使用 CICFlowMeter-V3 工具提取了 80 余项双向流统计特征 [4]，为机器学习建模提供了结构化输入。本研究选取其中 30 个核心特征，剔除源/目的 IP、端口号等易伪造或与拓扑强相关的字段，确保模型泛化能力与实用性。

2. **降维方法对比**：实验选用 PCA、LDA 与 t-SNE 三种降维方法，分别在 10、15、20 维设置下评估信息保留率与类间分离度。PCA 基于最大方差准则进行无监督降维 [5]，LDA 利用类别标签信息最大化类间距离与类内紧致度之比 [6]，t-SNE 通过保持高维邻域结构实现非线性降维与可视化 [7]。通过对比不同降维方法在特征压缩与结构保持上的效果，为后续分类任务提供理论支撑。

3. **分类器选择与调参**：实验采用 SVM、随机森林与逻辑回归三类分类器。SVM 通过核技巧将样本映射至高维空间并构造最大间隔超平面 [8]；随机森林通过树的随机化与集成策略降低过拟合风险 [9]；逻辑回归以线性模型与 Sigmoid 激活函数拟合类别概率 [10]。所有分类器均通过网格搜索与 3 折交叉验证进行超参数优化，确保模型在测试集上的泛化性能。

4. **性能指标与评估**：实验从准确率、误报率（False Positive Rate, FPR）、漏报率（False Negative Rate, FNR）与检测耗时四个维度评估模型性能。准确率反映模型整体预测能力；误报率与漏报率分别对应将正常流量误判为攻击与将攻击流量误判为正常的比例，直接影响入侵检测系统的实用性与安全性；检测耗时包括训练时间与单次预测时间，用于衡量模型在实时检测场景中的可行性。

5. **安全性分析与规则提取**：针对数据集中的高发攻击类型（如 DDoS），单独统计其检测精度、召回率与 F1 分数，评估模型对关键威胁的敏感性。此外，结合特征重要性与模型参数，提取可落地的入侵检测规则与安全建议，为实际部署提供参考。

### 1.3 技术路线

本研究的技术路线如下：首先对原始数据进行清洗与归一化，剔除无效样本并统一特征尺度；随后在标准化特征空间上应用 PCA、LDA 与 t-SNE 三种降维方法，生成不同维度的低维表示；接着在降维后的特征空间中训练 SVM、随机森林与逻辑回归三类分类器，通过网格搜索选择最优超参数；最后在测试集上评估各组合的准确率、误报率、漏报率与检测耗时，并绘制二维散点图与混淆矩阵以直观展示模型性能。全流程采用 Python 3.11 实现，使用 PyTorch 进行 GPU 加速的降维计算，使用 scikit-learn 进行分类器训练与评估。

---

## 2 数据集说明与预处理

### 2.1 数据集概述

本研究采用 CSE-CIC-IDS2018 数据集，该数据集由加拿大通信安全局与加拿大网络安全研究所于 2018 年联合发布，旨在为入侵检测机器学习研究提供真实且多样化的流量数据 [1][2]。与早期数据集（如 KDD'99、NSL-KDD）相比，CSE-CIC-IDS2018 在攻击覆盖范围、流量多样性与现实性上有显著改进 [3]。数据集采用结构化场景设计，通过"行为画像"系统模拟真实网络环境中的用户行为与攻击活动，覆盖 FTP、SSH、HTTP、HTTPS 等多协议流量，并包含 DDoS、暴力破解、SQL 注入、XSS 等多类攻击类型。

数据集提供了原始网络流量 PCAP 文件与由 CICFlowMeter-V3 抽取的流量统计特征 CSV 文件 [4]。CICFlowMeter 以双向流为单位，计算前向与后向方向的包数、字节数、速率、包长分布、标志位统计等 80 余项特征，为机器学习建模提供了结构化输入。本研究选用 2018 年 3 月 1 日（Thursday-01-03-2018）的流量数据，该数据包含正常流量与 DDoS 攻击流量，共计约 33 万条流记录，类别分布较为均衡，适合二分类场景下的模型训练与评估。

### 2.2 特征选择

CSE-CIC-IDS2018 数据集的原始 CSV 文件包含 80 余列特征，其中部分字段（如源/目的 IP 地址、端口号、Flow ID）与网络拓扑或会话标识强相关，在实际部署中容易被攻击者伪造或规避，不宜作为模型输入。此外，部分冗余特征（如总包数与前向/后向包数之和）在信息上存在重复，可能增加模型复杂度而无助于性能提升。基于上述考虑，本研究参考 Sharafaldin 等人的特征重要性分析 [3]，选取了 30 个核心流量统计特征，覆盖流时长、包数、字节数、速率、包长分布、标志位统计与活跃/空闲时间等维度。具体特征列表如下：

- **流时长与速率**：Flow Duration, Flow Byts/s, Flow Pkts/s
- **前向/后向包统计**：Tot Fwd Pkts, Tot Bwd Pkts, TotLen Fwd Pkts, TotLen Bwd Pkts
- **包长分布**：Fwd Pkt Len Max/Min/Mean/Std, Bwd Pkt Len Max/Min/Mean/Std
- **时间间隔**：Flow IAT Mean/Std/Max/Min, Fwd IAT Mean/Std, Bwd IAT Mean/Std
- **标志位计数**：SYN Flag Cnt, ACK Flag Cnt, PSH Flag Cnt, FIN Flag Cnt, RST Flag Cnt
- **活跃/空闲时间**：Active Mean, Idle Mean

这些特征基于流的统计属性，难以被攻击者在不改变攻击行为的前提下伪造，因而具有较高的检测鲁棒性与实用价值。

### 2.3 数据清洗与预处理

原始 CSV 文件在数据采集与特征提取过程中可能引入异常值与缺失值，需要进行系统清洗以确保后续建模的有效性。本研究的数据清洗流程包括以下步骤：

1. **删除重复表头行**：部分 CSV 文件在合并时混入了重复的列名行，通过检测 `Label` 列值为字符串 `"Label"` 的行并删除，确保数据纯净性。

2. **处理无穷值与缺失值**：CICFlowMeter 在计算速率特征时，若流时长为零可能导致除零错误并生成无穷值。本研究将所有 `inf` 与 `-inf` 替换为 `NaN`，随后删除含有 `NaN` 的样本行。该策略避免了数值填充引入的偏差，同时确保模型输入的数值稳定性。

3. **删除异常样本**：对于 `Flow Byts/s` 或 `Flow Pkts/s` 为 0 且 `Flow Duration` 为 0 的样本，其统计特征缺乏实际意义，予以删除。

4. **特征归一化**：由于不同特征的量纲与取值范围差异较大（如包长以字节计，时长以微秒计），直接输入模型可能导致某些特征主导训练过程。本研究采用 Min-Max 归一化将所有特征缩放至 [0, 1] 区间，公式为：

   $$x' = \frac{x - x_{\min}}{x_{\max} - x_{\min}}$$

   归一化后的特征空间有助于加速梯度下降收敛并提升模型泛化性能。

经过上述清洗流程，原始数据集从约 33 万条流记录减少至 32.8 万条有效样本，类别分布为正常流量（Benign）与 DDoS 攻击流量两类。最终按 80%/20% 比例划分训练集与测试集，使用分层采样确保类别比例一致，训练集包含 26.2 万样本，测试集包含 6.6 万样本。为加快实验进度并降低计算成本，训练集进一步采样至 5 万样本，保持类别平衡。

---

## 3 设计任务实现过程

### 3.1 降维方法实现

#### 3.1.1 主成分分析（PCA）

主成分分析是一种经典的无监督线性降维方法，其核心思想是通过正交变换将原始特征空间映射至新的坐标系，使得投影后的方差最大化 [5]。在数学上，PCA 通过对协方差矩阵进行特征值分解，选取前 $k$ 个最大特征值对应的特征向量作为主成分方向。设原始数据矩阵为 $X \in \mathbb{R}^{n \times d}$，其中 $n$ 为样本数，$d$ 为特征维度，则 PCA 的优化目标可表示为：

$$\max_{W} \text{tr}(W^T X^T X W), \quad \text{s.t. } W^T W = I$$

其中 $W \in \mathbb{R}^{d \times k}$ 为投影矩阵，$\text{tr}(\cdot)$ 表示矩阵迹。通过奇异值分解（SVD）求解上述优化问题，可得主成分方向与对应的方差贡献率。本研究使用 PyTorch 实现 GPU 加速的 PCA，通过 `torch.linalg.svd` 函数计算奇异值分解，支持大规模数据的高效处理。

PCA 的优势在于计算高效、理论成熟且易于解释，其方差解释率（Explained Variance Ratio）可直接量化降维后的信息保留程度。然而，PCA 作为无监督方法，未利用类别标签信息，在类别可分性上可能不如有监督降维方法。本研究分别在 10、15、20 维设置下应用 PCA，并记录各维度的累积方差解释率，作为后续分析的依据。

#### 3.1.2 线性判别分析（LDA）

线性判别分析是一种有监督的线性降维方法，通过最大化类间散度与类内散度之比，寻求使不同类别样本在投影空间中最大程度分离的投影方向 [6]。LDA 的优化目标可表示为：

$$\max_{W} \frac{|W^T S_B W|}{|W^T S_W W|}$$

其中 $S_B$ 为类间散度矩阵，$S_W$ 为类内散度矩阵。通过求解广义特征值问题 $S_B w = \lambda S_W w$，可得投影方向 $W$。LDA 的最大投影维度受类别数限制，对于 $C$ 分类问题，最多可降至 $C-1$ 维。本研究的数据集为二分类（正常流量与 DDoS 攻击），因此 LDA 最多可降至 1 维。实验中，本研究在 15 维设置下应用 LDA，以保持与其他降维方法的可比性。

LDA 的优势在于引入了类别标签信息，能够在降维的同时最大化类别可分性，对于分类任务具有天然优势。然而，LDA 假设各类样本服从高斯分布且协方差矩阵相同，在实际数据中该假设可能不成立。此外，LDA 的计算涉及矩阵求逆，对于高维数据可能存在数值不稳定问题。本研究使用 PyTorch 实现 LDA，并在矩阵求逆前添加正则化项以提升数值稳定性。

#### 3.1.3 t-分布随机邻域嵌入（t-SNE）

t-SNE 是一种非线性降维方法，主要用于高维数据的可视化与聚类分析 [7]。与 PCA 和 LDA 不同，t-SNE 不对全局结构进行建模，而是侧重于保持高维空间中的局部邻域关系。具体而言，t-SNE 首先在高维空间中计算样本对之间的相似度，并用高斯分布建模；随后在低维空间中用 t 分布建模样本对相似度，通过最小化两个分布之间的 Kullback-Leibler 散度，优化低维嵌入。

t-SNE 的优化目标为：

$$\min_{Y} \sum_{i,j} p_{ij} \log \frac{p_{ij}}{q_{ij}}$$

其中 $p_{ij}$ 为高维空间中样本 $i$ 与 $j$ 的联合概率，$q_{ij}$ 为低维空间中对应的概率，$Y$ 为低维嵌入坐标。t-SNE 通过梯度下降优化上述目标，其计算复杂度较高（$O(n^2)$），但在保持簇结构与局部邻域关系上表现优异。

本研究使用 PyTorch 实现 GPU 加速的 t-SNE，固定 perplexity=30、learning_rate=200、迭代次数=1000，在 15 维设置下进行降维。需要注意的是，t-SNE 主要用于可视化，其低维嵌入并非全局最优，且对初始化敏感。因此，本研究在二维可视化中使用 t-SNE，同时将其作为降维方法之一进行性能评估，以全面对比不同降维策略的效果。

### 3.2 分类器实现

#### 3.2.1 支持向量机（SVM）

支持向量机通过核技巧将样本映射至高维特征空间，并在该空间中构造最大间隔超平面，以实现线性或非线性分类 [8]。对于线性可分问题，SVM 的优化目标为：

$$\min_{w, b} \frac{1}{2} \|w\|^2, \quad \text{s.t. } y_i (w^T x_i + b) \geq 1, \forall i$$

对于非线性问题，SVM 引入核函数 $K(x_i, x_j)$ 将样本映射至高维空间，常用的核函数包括线性核、多项式核与径向基函数（RBF）核。本研究采用 RBF 核，其形式为：

$$K(x_i, x_j) = \exp\left(-\gamma \|x_i - x_j\|^2\right)$$

SVM 的超参数包括惩罚系数 $C$（控制间隔与误分类的平衡）与核参数 $\gamma$（控制核函数的宽度）。本研究通过网格搜索在 $C \in \{0.1, 1, 10\}$、$\text{kernel} \in \{\text{linear}, \text{rbf}\}$、$\gamma \in \{\text{scale}, \text{auto}\}$ 的参数空间中选择最优配置，使用 3 折交叉验证并以 F1 宏平均作为评分标准。

#### 3.2.2 随机森林

随机森林是一种基于决策树的集成学习方法，通过 Bootstrap 采样与随机特征选择构造多棵决策树，并通过投票或平均的方式融合预测结果 [9]。随机森林的核心优势在于通过树的随机化降低单棵树的过拟合风险，同时通过集成策略提升整体泛化性能。此外，随机森林提供了特征重要性评估，可用于解释模型决策与提取规则。

本研究的随机森林超参数包括树的数量 $n_{\text{estimators}} \in \{200, 500\}$、最大深度 $\text{max_depth} \in \{\text{None}, 10, 20\}$ 与最小分裂样本数 $\text{min_samples_split} \in \{2, 5\}$。通过网格搜索与 3 折交叉验证选择最优配置，同样以 F1 宏平均作为评分标准。

#### 3.2.3 逻辑回归

逻辑回归是一种经典的线性分类模型，通过 Sigmoid 激活函数将线性组合映射至 [0, 1] 区间，并以交叉熵损失优化模型参数 [10]。逻辑回归的决策函数为：

$$P(y=1|x) = \frac{1}{1 + \exp(-w^T x - b)}$$

本研究使用 PyTorch 实现 GPU 加速的逻辑回归，通过 L-BFGS 优化器进行参数估计。超参数包括正则化系数 $C \in \{0.1, 1, 10\}$，通过网格搜索与 3 折交叉验证选择最优配置。逻辑回归的优势在于模型简洁、训练高效且可解释性强，适合作为基线方法进行对比。

### 3.3 实验设计

本研究的实验设计采用"降维×分类"的组合策略，共包含 15 组实验：

- **PCA 实验**：在 10、15、20 维设置下，分别训练 SVM、随机森林与逻辑回归，共 9 组实验。
- **LDA 实验**：在 15 维设置下，分别训练 SVM、随机森林与逻辑回归，共 3 组实验。
- **t-SNE 实验**：在 15 维设置下，分别训练 SVM、随机森林与逻辑回归，共 3 组实验。

所有实验均在相同的训练集与测试集上进行，确保结果的可比性。为提升计算效率，本研究对训练集进行采样，从 26.2 万样本减少至 5 万样本，保持类别平衡。降维计算使用 PyTorch 在 NVIDIA GeForce RTX 4060 GPU 上加速，分类器训练使用 scikit-learn 在 16 核 CPU 上并行计算。

---

## 4 算法对比与结果分析

### 4.1 降维效果评估

[待填充：降维方法在不同维度下的信息保留率与类间分离度对比]

### 4.2 分类性能对比

[待填充：15 组"降维×分类"组合的准确率、误报率、漏报率与检测耗时对比]

### 4.3 可视化分析

[待填充：降维后的二维散点图分析]

### 4.4 攻击类型检测分析

[待填充：DDoS 攻击的检测精度、召回率与 F1 分数]

### 4.5 误报与漏报分析

[待填充：从安全性角度分析误报与漏报的影响]

---

## 5 总结与改进方向

### 5.1 研究总结

[待填充：总结主要发现与结论]

### 5.2 改进方向

[待填充：讨论未来改进方向，如增量学习、半监督方法、更多特征选择策略等]

---

## 参考文献

[1] CSE-CIC-IDS2018 on AWS. Available: https://registry.opendata.aws/cse-cic-ids2018/
[2] Canadian Institute for Cybersecurity. CIC-IDS2018 Dataset. Available: https://www.unb.ca/cic/datasets/ids-2018.html
[3] I. Sharafaldin, A. H. Lashkari, and A. A. Ghorbani, "Toward Generating a New Intrusion Detection Dataset and Intrusion Traffic Characterization," in Proceedings of the 4th International Conference on Information Systems Security and Privacy (ICISSP), 2018.
[4] Canadian Institute for Cybersecurity. CICFlowMeter. Available: https://www.unb.ca/cic/research/applications.html#CICFlowMeter
[5] I. T. Jolliffe, Principal Component Analysis, 2nd ed. New York: Springer, 2002.
[6] R. A. Fisher, "The Use of Multiple Measurements in Taxonomic Problems," Annals of Eugenics, vol. 7, no. 2, pp. 179–188, 1936.
[7] L. van der Maaten and G. Hinton, "Visualizing Data using t-SNE," Journal of Machine Learning Research, vol. 9, pp. 2579–2605, 2008.
[8] C. Cortes and V. Vapnik, "Support-Vector Networks," Machine Learning, vol. 20, no. 3, pp. 273–297, 1995.
[9] L. Breiman, "Random Forests," Machine Learning, vol. 45, no. 1, pp. 5–32, 2001.
[10] D. W. Hosmer, S. Lemeshow, and R. X. Sturdivant, Applied Logistic Regression, 3rd ed. Hoboken, NJ: Wiley, 2013.

---

## 附录

### 附录 A：实验结果汇总

详见 `results.md`

### 附录 B：入侵检测规则提取

详见 `rules.md`

### 附录 C：代码与数据

详见 `README.md`
